<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mural de Miss√µes - Taverna</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        body {
            background: #2c1b10;
            background-image: url('https://www.transparenttextures.com/patterns/dark-wood.png');
            color: #3d2411;
            font-family: 'Georgia', serif;
            margin: 0; padding: 20px; padding-bottom: 100px;
        }
        h1 { text-align: center; color: #f3e5ab; text-shadow: 2px 2px 4px #000; font-size: 2.2rem; }
        .mural { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; max-width: 1200px; margin: 0 auto; }

        .pergaminho {
            background: #f4e4bc;
            background-image: url('https://www.transparenttextures.com/patterns/paper-fibers.png');
            padding: 25px; border-radius: 2px; box-shadow: 5px 5px 15px rgba(0,0,0,0.5);
            border: 1px solid #d2b48c; position: relative; display: flex; flex-direction: column;
        }

        .tag { position: absolute; top: 10px; right: 10px; padding: 5px 10px; border-radius: 3px; font-size: 0.7rem; font-weight: bold; color: white; }
        .tipo-combate { background: #8b0000; } .tipo-coleta { background: #228b22; } .tipo-expedicao { background: #4169e1; }

        .missao-titulo { font-size: 1.4rem; border-bottom: 2px solid #3d2411; margin-bottom: 12px; font-weight: bold; text-align: center; }
        .tempo-restante { color: #8b0000; font-weight: bold; text-align: center; font-family: monospace; font-size: 1.1rem; margin-bottom: 10px; }
        .desc { font-style: italic; margin-top: 15px; flex-grow: 1; border-top: 1px solid rgba(0,0,0,0.1); padding-top: 10px; font-size: 0.9rem; }
        .recompensa { margin-top: 15px; padding: 10px; border: 1px dashed #3d2411; text-align: center; font-weight: bold; color: #228b22; }
        
        .status-aceito { background: #d2b48c; color: #5d3a1a; padding: 8px; text-align: center; font-weight: bold; margin-top: 10px; border-radius: 4px; font-size: 0.8rem; }

        .modal {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #f3e5ab; padding: 25px; border: 4px double #3d2411;
            box-shadow: 0 0 100px #000; z-index: 10000; display: none; width: 90%; max-width: 400px;
        }

        input, textarea, select { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #3d2411; box-sizing: border-box; background: #fffcf0; }
        .btn { background: #5d3a1a; color: #f4e4bc; border: none; padding: 12px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 5px; border-radius: 4px; }
        .btn-mestre-float { position: fixed; bottom: 20px; right: 20px; background: rgba(0,0,0,0.6); color: white; border: 1px solid #f3e5ab; border-radius: 50%; width: 45px; height: 45px; cursor: pointer; z-index: 999; }
    </style>
</head>
<body>

    <div id="loginScreen" style="text-align: center; margin-top: 100px;">
        <div style="background: #f4e4bc; display: inline-block; padding: 30px; border: 2px solid #3d2411; border-radius: 8px;">
            <h2>üìú Identifique-se Aventureiro</h2>
            <input type="text" id="playerNome" placeholder="Seu Nome de Personagem" style="max-width: 250px;"><br>
            <button class="btn" onclick="fazerLogin()">Entrar na Taverna</button>
        </div>
    </div>

    <div id="muralScreen" style="display: none;">
        <h1>üìú Mural de Miss√µes</h1>
        <p style="text-align: center; color: #f3e5ab;">Bem-vindo, <span id="nomeDisplay"></span>!</p>
        <div class="mural" id="muralMissoes"></div>
        <button class="btn-mestre-float" onclick="abrirPainelMestre()">üõ†Ô∏è</button>
    </div>

    <div id="modalSenhaMestre" class="modal">
        <h3 style="text-align:center">üõ°Ô∏è Acesso do Mestre</h3>
        <input type="password" id="senhaMestreInput" placeholder="Senha Secreta">
        <button class="btn" onclick="confirmarMestre()">Validar</button>
        <button class="btn" style="background:#8b0000" onclick="fecharModais()">Cancelar</button>
    </div>

    <div id="painelCriar" class="modal" style="max-width: 500px;">
        <h3 style="text-align:center">‚ûï Nova Miss√£o</h3>
        <input type="text" id="qTitulo" placeholder="T√≠tulo da Miss√£o">
        <select id="qTipo">
            <option value="combate">‚öîÔ∏è Combate</option>
            <option value="coleta">üåø Coleta</option>
            <option value="expedicao">üó∫Ô∏è Expedi√ß√£o</option>
        </select>
        <input type="text" id="qLocal" placeholder="Localiza√ß√£o">
        <input type="number" id="qHoras" placeholder="Tempo de dura√ß√£o (em HORAS - ex: 24)">
        <input type="text" id="qRecompensa" placeholder="Recompensa (Ex: 1000 Moedas)">
        <textarea id="qDesc" rows="4" placeholder="Detalhes da miss√£o..."></textarea>
        <button class="btn" style="background:#228b22" onclick="salvarMissao()">Pregar no Mural</button>
        <button class="btn" style="background:#8b0000" onclick="fecharModais()">Fechar</button>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAsq9HAbLMReGnDX9jfRnChPF-R0f0rDfA",
            authDomain: "dungeon-hunters-15a90.firebaseapp.com",
            databaseURL: "https://dungeon-hunters-15a90-default-rtdb.firebaseio.com",
            projectId: "dungeon-hunters-15a90",
            storageBucket: "dungeon-hunters-15a90.firebasestorage.app",
            messagingSenderId: "386699061769",
            appId: "1:386699061769:web:30f9023befc43da2ab66d8"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let usuarioAtual = "";
        let ehMestre = false;
        const SENHA_REAL = "123"; 

        function fazerLogin() {
            usuarioAtual = document.getElementById('playerNome').value.trim();
            if(!usuarioAtual) return alert("Digite seu nome!");
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('muralScreen').style.display = 'block';
            document.getElementById('nomeDisplay').innerText = usuarioAtual;
            renderizarMural();
        }

        function abrirPainelMestre() {
            if(ehMestre) document.getElementById('painelCriar').style.display = 'block';
            else document.getElementById('modalSenhaMestre').style.display = 'block';
        }

        function confirmarMestre() {
            if(document.getElementById('senhaMestreInput').value === SENHA_REAL) {
                ehMestre = true;
                fecharModais();
                document.getElementById('painelCriar').style.display = 'block';
                renderizarMural();
            } else alert("Senha incorreta!");
        }

        function fecharModais() {
            document.getElementById('modalSenhaMestre').style.display = 'none';
            document.getElementById('painelCriar').style.display = 'none';
        }

        function salvarMissao() {
            const horas = parseInt(document.getElementById('qHoras').value);
            if(isNaN(horas)) return alert("Coloque o tempo em horas!");
            
            const expiraEm = Date.now() + (horas * 60 * 60 * 1000);

            const m = {
                titulo: document.getElementById('qTitulo').value,
                tipo: document.getElementById('qTipo').value,
                local: document.getElementById('qLocal').value,
                expiraEm: expiraEm,
                recompensa: document.getElementById('qRecompensa').value,
                desc: document.getElementById('qDesc').value,
                aceitoPor: ""
            };
            if(!m.titulo) return;
            db.ref('missoes').push(m).then(() => { fecharModais(); alert("Miss√£o Pregada!"); });
        }

        function atualizarCronometros() {
            const agora = Date.now();
            document.querySelectorAll('.cronometro').forEach(el => {
                const expira = parseInt(el.dataset.expira);
                const diff = expira - agora;
                if(diff <= 0) {
                    el.innerText = "EXPIRADA";
                    el.style.color = "gray";
                } else {
                    const h = Math.floor(diff / 3600000);
                    const m = Math.floor((diff % 3600000) / 60000);
                    const s = Math.floor((diff % 60000) / 1000);
                    el.innerText = `${h}h ${m}m ${s}s`;
                }
            });
        }
        setInterval(atualizarCronometros, 1000);

        function aceitarMissao(id, titulo) {
            if(confirm("Deseja aceitar a miss√£o: " + titulo + "?")) {
                db.ref('missoes/' + id).update({ aceitoPor: usuarioAtual });
            }
        }

        function removerMissao(id) {
            if(confirm("Deseja remover este pergaminho?")) {
                db.ref('missoes/' + id).remove();
            }
        }

        function renderizarMural() {
            db.ref('missoes').on('value', snap => {
                let html = "";
                snap.forEach(child => {
                    const m = child.val();
                    const id = child.key;
                    let statusHtml = m.aceitoPor ? `<div class="status-aceito">üìå Aceita por: ${m.aceitoPor}</div>` : 
                                     `<button class="btn" onclick="aceitarMissao('${id}', '${m.titulo}')">Aceitar Miss√£o</button>`;

                    let btnMestre = ehMestre ? `<button onclick="removerMissao('${id}')" style="background:#8b0000; color:white; border:none; padding:8px; margin-top:10px; cursor:pointer; width:100%; border-radius:4px;">üóëÔ∏è Remover (Mestre)</button>` : "";

                    html += `
                    <div class="pergaminho">
                        <div class="tag tipo-${m.tipo}">${m.tipo}</div>
                        <div class="missao-titulo">${m.titulo}</div>
                        <div class="tempo-restante">‚è≥ <span class="cronometro" data-expira="${m.expiraEm}">--:--:--</span></div>
                        <div class="info-row"><strong>üìç Local:</strong> ${m.local}</div>
                        <div class="desc">${m.desc}</div>
                        <div class="recompensa">üí∞ ${m.recompensa}</div>
                        ${statusHtml}
                        ${btnMestre}
                    </div>`;
                });
                document.getElementById('muralMissoes').innerHTML = html || "<p style='text-align:center; color:#f4e4bc;'>Nenhuma miss√£o dispon√≠vel.</p>";
            });
        }
    </script>
</body>
</html>
